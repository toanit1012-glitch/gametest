<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Admin ‚Äì Royal Live Vote</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Bootstrap -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

<!-- Toastr -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>

<!-- Animate.css -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

<!-- Confetti -->
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<!-- Google Font -->
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700;800&display=swap" rel="stylesheet">

<style>
body {
    background: radial-gradient(circle at top, #fff7cc, #f3e5ab);
    min-height: 100vh;
    font-family: Arial;
}

h1 {
    font-family: 'Cinzel', serif;
    text-align: center;
    color: #b8860b;
    margin: 25px 0;
    text-shadow: 0 0 8px gold;
}

/* Card vote */
#voteList {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    justify-content: center;
    padding-bottom: 50px;
}

.vote-card {
    width: 220px;
    background: linear-gradient(135deg,#ffd700,#fff8dc);
    border-radius: 15px;
    border: 2px solid gold;
    padding: 15px;
    text-align: center;
    box-shadow: 0 0 20px rgba(255,215,0,.8);
}

.vote-card b {
    font-size: 18px;
    color: #5a3b00;
}

.vote-card small {
    color: #7a5a00;
}

/* Toastr custom */
.toast-success {
    background: linear-gradient(135deg,#ffd700,#fff1a8) !important;
    color: #5a3b00 !important;
    box-shadow: 0 0 25px gold;
}
</style>
</head>

<body>

<audio id="notifySound">
    <source src="/audio.mp3" type="audio/mpeg">
</audio>

<h1>üëë ROYAL LIVE VOTE üëë</h1>

<div id="voteList"></div>

<script>
const API_CHECK = "https://tri-viet.com.vn/User/CheckNewVote";
const audio = document.getElementById("notifySound");
let lastSender = null;

// Toastr config
toastr.options = {
    closeButton: true,
    progressBar: true,
    positionClass: "toast-top-right",
    timeOut: 4500,
    showMethod: "slideDown",
    hideMethod: "fadeOut"
};

function fireConfetti() {
    confetti({
        particleCount: 150,
        spread: 90,
        origin: { y: 0.6 },
        colors: ['#ffd700','#ffec8b','#fff']
    });
}

function showVote(sender) {
    audio.currentTime = 0;
    
    audio.play();

    toastr.success(`üë§ <b>${sender}</b> v·ª´a b√¨nh ch·ªçn!`, "B√åNH CH·ªåN M·ªöI");

    fireConfetti();

    const card = document.createElement("div");
    card.className = "vote-card animate__animated animate__bounceIn";
    card.innerHTML = `
        <b>${sender}</b><br>
        <small>${new Date().toLocaleString("vi-VN")}</small>
    `;

    const list = document.getElementById("voteList");
    list.prepend(card);

    if (list.children.length > 12) {
        list.removeChild(list.lastChild);
    }
}

// Polling
setInterval(() => {
    $.get(API_CHECK, res => {
        if (res.hasNew && res.sender !== lastSender) {
            lastSender = res.sender;
            showVote(res.sender);
        }
    });
}, 3000);
</script>

</body>
</html>
