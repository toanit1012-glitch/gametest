<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>King & Queen of the Year 2025</title>

<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<style>
    body { font-family: Arial; max-width: 700px; margin: auto; }
    h2 { text-align: center; }
    button { padding: 8px 16px; margin-top: 10px; }
</style>
</head>
<body>

<h2>ğŸ‘‘ King & Queen of the Year 2025 ğŸ‘‘</h2>

<form id="pollForm">

    <h3>1ï¸âƒ£ KING</h3>
    <label><input type="radio" name="king" value="Sao má»™c" required> Sao má»™c</label><br>
    <label><input type="radio" name="king" value="Sao thá»•"> Sao thá»•</label><br>
    <label><input type="radio" name="king" value="Sao kim"> Sao kim</label>

    <h3>2ï¸âƒ£ QUEEN</h3>
    <label><input type="radio" name="queen" value="Sao hoáº£" required> Sao hoáº£</label><br>
    <label><input type="radio" name="queen" value="Sao háº£i vÆ°Æ¡ng"> Sao háº£i vÆ°Æ¡ng</label><br>
    <label><input type="radio" name="queen" value="Sao thiÃªn vÆ°Æ¡ng"> Sao thiÃªn vÆ°Æ¡ng</label>

    <br><br>
    ğŸ‘¤ TÃªn ngÆ°á»i gá»­i:
    <input type="text" name="sender" required>

    <br>
    <button type="submit">Gá»­i bÃ¬nh chá»n</button>
</form>

<hr>
<div class="toast-container position-fixed top-0 end-0 p-3">
    <div id="voteToast" class="toast align-items-center text-bg-success border-0" role="alert">
        <div class="d-flex">
            <div class="toast-body">
                ğŸ‰ Cáº£m Æ¡n báº¡n Ä‘Ã£ bÃ¬nh chá»n!
            </div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
        </div>
    </div>
</div>


<h3>ğŸ“Š Káº¿t quáº£ trá»±c quan</h3>
<canvas id="kingChart"></canvas>
<br>
<canvas id="queenChart"></canvas>

<script>
let kingChart, queenChart;
const API = "https://localhost:44347/User"; // Ä‘á»•i náº¿u cáº§n

function loadResults() {
    $.getJSON(API + "/GetResults", function (data) {

        if (kingChart) kingChart.destroy();
        kingChart = new Chart(document.getElementById('kingChart'), {
            type: 'bar',
            data: {
                labels: data.King.map(x => x.Choice),
                datasets: [{
                    label: 'King Votes',
                    data: data.King.map(x => x.Count),
                    backgroundColor: '#28a745'
                }]
            }
        });

        if (queenChart) queenChart.destroy();
        queenChart = new Chart(document.getElementById('queenChart'), {
            type: 'bar',
            data: {
                labels: data.Queen.map(x => x.Choice),
                datasets: [{
                    label: 'Queen Votes',
                    data: data.Queen.map(x => x.Count),
                    backgroundColor: '#6f42c1'
                }]
            }
        });
    });
}

$('#pollForm').submit(function (e) {
    e.preventDefault();

    $.ajax({
        url: API + "/SubmitVote",
        method: "POST",
        data: $(this).serialize(),
        success: function (res) {
   const toastEl = document.getElementById('voteToast');
            const toast = new bootstrap.Toast(toastEl, { delay: 2500 });
            toast.show();            loadResults();
            $('#pollForm')[0].reset();
        }
    });
});

loadResults();
</script>

</body>
</html>
