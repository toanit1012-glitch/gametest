<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>King & Queen of the Year 2025</title>

<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<style>
    body { font-family: Arial; max-width: 700px; margin: auto; }
    h2 { text-align: center; }
    button { padding: 8px 16px; margin-top: 10px; }
    /* ph√≥ng to radio */
input[type="radio"] {
    transform: scale(1.6);
    margin-right: 10px;
}

/* label to ‚Äì d·ªÖ b·∫•m */
label {
    font-size: 20px;
    line-height: 2.2;
    cursor: pointer;
}

/* kho·∫£ng c√°ch t·ª´ng d√≤ng */
label input {
    vertical-align: middle;
}
</style>
</head>
<body>

<h2>üëë King & Queen of the Year 2025 üëë</h2>

<form id="pollForm">

    <h3>1Ô∏è‚É£ KING</h3>
    <label><input type="radio" name="king" value="Sao m·ªôc" required> Sao m·ªôc</label><br>
    <label><input type="radio" name="king" value="Sao th·ªï"> Sao th·ªï</label><br>
    <label><input type="radio" name="king" value="Sao kim"> Sao kim</label>

    <h3>2Ô∏è‚É£ QUEEN</h3>
    <label><input type="radio" name="queen" value="Sao ho·∫£" required> Sao ho·∫£</label><br>
    <label><input type="radio" name="queen" value="Sao h·∫£i v∆∞∆°ng"> Sao h·∫£i v∆∞∆°ng</label><br>
    <label><input type="radio" name="queen" value="Sao thi√™n v∆∞∆°ng"> Sao thi√™n v∆∞∆°ng</label>

    <br><br>
    üë§ T√™n ng∆∞·ªùi g·ª≠i:
    <input type="text" name="sender" required id="id-user">

    <br>
    <button type="submit">G·ª≠i b√¨nh ch·ªçn</button>
</form>

<hr>
<div class="toast-container position-fixed top-0 end-0 p-3">
    <div id="voteToast" class="toast align-items-center text-bg-success border-0">
        <div class="d-flex">
            <div class="toast-body" id="toastText">
                <!-- text s·∫Ω set b·∫±ng JS -->
            </div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto"
                    data-bs-dismiss="toast"></button>
        </div>
    </div>
</div>


<h3>üìä K·∫øt qu·∫£ tr·ª±c quan</h3>
<canvas id="kingChart"></canvas>
<br>
<canvas id="queenChart"></canvas>

<script>
let kingChart, queenChart;
const API = "https://tri-viet.com.vn/User"; // ƒë·ªïi n·∫øu c·∫ßn

function loadResults() {
    $.getJSON(API + "/GetResults", function (data) {

        if (kingChart) kingChart.destroy();
        kingChart = new Chart(document.getElementById('kingChart'), {
            type: 'bar',
            data: {
                labels: data.King.map(x => x.Choice),
                datasets: [{
                    label: 'King Votes',
                    data: data.King.map(x => x.Count),
                    backgroundColor: '#28a745'
                }]
            }
        });

        if (queenChart) queenChart.destroy();
        queenChart = new Chart(document.getElementById('queenChart'), {
            type: 'bar',
            data: {
                labels: data.Queen.map(x => x.Choice),
                datasets: [{
                    label: 'Queen Votes',
                    data: data.Queen.map(x => x.Count),
                    backgroundColor: '#6f42c1'
                }]
            }
        });
    });
}

$('#pollForm').submit(function (e) {
    e.preventDefault();

    $.ajax({
        url: API + "/SubmitVote",
        method: "POST",
        data: $(this).serialize(),
        success: function (res) {


            document.getElementById("toastText").innerHTML =
                `üéâ <b>${$("#id-user").val()}</b> ƒë√£ b√¨nh ch·ªçn th√†nh c√¥ng!`;

            const toastEl = document.getElementById('voteToast');
            const toast = new bootstrap.Toast(toastEl, { delay: 2500 });
            toast.show(); // ‚≠ê B·∫ÆT BU·ªòC

               loadResults();
            $('#pollForm')[0].reset();
        }
    });
});

loadResults();
</script>

</body>
</html>
